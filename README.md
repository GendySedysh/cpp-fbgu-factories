# Заводы
Тестовое задание на работу с многопоточностью.

## Описание
---
Описание задания можно посмотреть в файле `Subject.txt`

## Ход решения
---
В решении использовалась структура `Product` и классы `Factory`, `FactoryCreator`, `Warehouse`, `TruckCreator`, `Truck`.

`Warehouse` - склад хранения продуктов. Для обеспечения потокобезопасности имеет поле `mutex` использующееся для `lock_guard` в нужных местах. Так же подсчитывает приходящую продукцию для создания весов, они нужны для балансировки выгрузки продукции с помощью `Truck`'ов.

`Factory` - заводится в отдельный тред, по входным данным вычисляется раз в какое время завод выдаёт продукцию.

`FactoryCreator` - реализация паттерна "Factory", нужен для облегчения создания заводов.

`Truck` - класс который производит забор продукции со склада. Создаётся с рандомной вместимостью.

`TruckCreator` - реализация паттерна "Factory", нужен для облегчения создания грузовиков. Так же осуществляет надзор за складом. При близком переполнении склада `(95%)` отправляет грузовики на склад. При необходимости создаёт для себя дополнительные грузовики.

Общий смысл такой: у пользователя запрашивают входные данные, затем создаются заводы и инициализируются треды. Один на каждый завод. Так же есть поток в котором крутятся метод по выдаче текущей статистики заполненности склада и поток который следит за наполненностью склада и отправляет по надобности грузовики.
По нажатии клавиши `Enter` тредам отправляется команда на завершение работы и после их остановки выводится статистика по работе грузовиков. Сколько каких товаров они выгрузили и какие товары чаще вывозили.

## Сборка
---
Тестирование происходило на WSL2 с Ubuntu. Сборка происходит с помощью `CMake`.

Порядок сборки (из коренной папки репозитория):
```
mkdir build && cd build
cmake .. && cmake --build .
```

## Запуск
---
Из папки build:
```
./program
```
P.S. при ограничениях по умолчанию параметра `M`(сколько склад может вмещать, ограничен снизу 100) симуляцию происходит очень медленно. При тестах советую закомментировать строки 35-38 `main.cpp` файла и задавать параметр `Enter basic storage amount` как 1. Так симуляция пройдёт в разы быстрее и можно будет буквально за пару минут посмотреть работу программы.

## Скриншоты работы
---
Так выглядит вывод логов во время работы:

![Runtime-log](https://github.com/user-attachments/assets/1b33f591-aaea-4fe7-9c84-25f393ce414d)

Так выглядит вывод логов в конце(данные по грузовикам):
![Truck-log](https://github.com/user-attachments/assets/c790bb6e-a05f-4a99-bcef-7ae9f772b4b4)
